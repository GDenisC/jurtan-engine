import { Instance } from "./instance.js";
export const images = [];
export const loadImage = (src) => {
    const image = images.find(i => i.id == src);
    if (image)
        return image;
    const img = new Image();
    img.src = src;
    img.id = src;
    images.push(img);
    return img;
};
export class ImageInstance extends Instance {
    constructor(imageUrl) {
        super();
        this.scaleX = 1;
        this.scaleY = 1;
        this.image = loadImage(imageUrl);
    }
    onDraw() {
        this.drawSelf();
    }
    drawSelf() {
        if (!this.image.src)
            return;
        this.drawImage(this.image, 0, 0, this.image.width * this.scaleX, this.image.height * this.scaleY);
    }
    get width() {
        return this.image.width * this.scaleX;
    }
    set width(w) {
        this.scaleX = w / this.width;
    }
    get height() {
        return this.image.height * this.scaleY;
    }
    set height(h) {
        this.scaleY = h / this.height;
    }
    get center() {
        return this.rect.center;
    }
    set center(p) {
        this.x = p.x - this.width / 2;
        this.y = p.y - this.height / 2;
    }
    get rect() {
        return this.getRect(this.width, this.height);
    }
}
// TODO: fix copy-paste
export class Image9Instance extends Instance {
    constructor(imageUrl, pad) {
        super();
        this.pad = pad;
        this.scaleX = 1;
        this.scaleY = 1;
        this.image = loadImage(imageUrl);
        this.imageSlices = [];
        new Promise(resolve => {
            this.image.addEventListener('load', resolve);
        }).then(() => {
            // define the 9 parts as [x, y, w, h]
            this.imageSlices = [
                [0, 0],
                [pad, 0],
                [pad * 2, 0],
                [0, pad],
                [pad, pad],
                [pad * 2, pad],
                [0, pad * 2],
                [pad, pad * 2],
                [pad * 2, pad * 2]
            ].map(x => [x[0], x[1], pad, pad]);
        });
    }
    onDraw() {
        this.drawSelf();
    }
    drawSelf() {
        if (!this.image.src)
            return;
        const { pad, imageSlices, image, ctx } = this;
        ctx.translate(-this.width / 2, -this.height / 2);
        const size = 0.5;
        let width = this.width + size, height = this.height + size, x = size, y = size;
        ctx.drawImage(image, ...imageSlices[0], x, y, pad, pad);
        ctx.drawImage(image, ...imageSlices[2], width - pad - x, y, pad, pad);
        ctx.drawImage(image, ...imageSlices[6], x, height - pad - y, pad, pad);
        ctx.drawImage(image, ...imageSlices[8], width - pad - x, height - pad - y, pad, pad);
        ctx.drawImage(image, ...imageSlices[1], pad, y, width - 2 * pad, pad);
        ctx.drawImage(image, ...imageSlices[7], pad, height - pad - y, width - 2 * pad, pad);
        ctx.drawImage(image, ...imageSlices[3], x, pad, pad, height - 2 * pad);
        ctx.drawImage(image, ...imageSlices[5], width - pad - x, pad, pad, height - 2 * pad);
        ctx.drawImage(image, ...imageSlices[4], pad, pad, width - 2 * pad, height - 2 * pad);
    }
    get rect() {
        return this.getRect(this.width, this.height);
    }
    get width() {
        return this.image.width * this.scaleX;
    }
    set width(w) {
        this.scaleX = w / this.width;
    }
    get height() {
        return this.image.height * this.scaleY;
    }
    set height(h) {
        this.scaleY = h / this.height;
    }
    get center() {
        return this.rect.center;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2VzLmpzIiwic291cmNlUm9vdCI6ImplLXNyYy8iLCJzb3VyY2VzIjpbImltYWdlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBR3pDLE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBdUIsRUFBRSxDQUFDO0FBRTdDLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxDQUFDLEdBQVcsRUFBRSxFQUFFO0lBQ3JDLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLEdBQUcsQ0FBQyxDQUFDO0lBQzVDLElBQUksS0FBSztRQUFFLE9BQU8sS0FBSyxDQUFDO0lBQ3hCLE1BQU0sR0FBRyxHQUFHLElBQUksS0FBSyxFQUFFLENBQUM7SUFDeEIsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFDZCxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQztJQUNiLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakIsT0FBTyxHQUFHLENBQUM7QUFDZixDQUFDLENBQUE7QUFFRCxNQUFNLE9BQU8sYUFBYyxTQUFRLFFBQVE7SUFLdkMsWUFBWSxRQUFnQjtRQUN4QixLQUFLLEVBQUUsQ0FBQztRQUpKLFdBQU0sR0FBRyxDQUFDLENBQUM7UUFDWCxXQUFNLEdBQUcsQ0FBQyxDQUFDO1FBSWYsSUFBSSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVELE1BQU07UUFDRixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDcEIsQ0FBQztJQUVELFFBQVE7UUFDSixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHO1lBQ2YsT0FBTztRQUNYLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3RHLENBQUM7SUFFRCxJQUFJLEtBQUs7UUFDTCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDMUMsQ0FBQztJQUVELElBQUksS0FBSyxDQUFDLENBQUM7UUFDUCxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ2pDLENBQUM7SUFFRCxJQUFJLE1BQU07UUFDTixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDM0MsQ0FBQztJQUVELElBQUksTUFBTSxDQUFDLENBQUM7UUFDUixJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ2xDLENBQUM7SUFFRCxJQUFJLE1BQU07UUFDTixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQzVCLENBQUM7SUFFRCxJQUFJLE1BQU0sQ0FBQyxDQUFRO1FBQ2YsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUQsSUFBSSxJQUFJO1FBQ0osT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pELENBQUM7Q0FDSjtBQUVELHVCQUF1QjtBQUN2QixNQUFNLE9BQU8sY0FBZSxTQUFRLFFBQVE7SUFNeEMsWUFBWSxRQUFnQixFQUFTLEdBQVc7UUFDNUMsS0FBSyxFQUFFLENBQUM7UUFEeUIsUUFBRyxHQUFILEdBQUcsQ0FBUTtRQUh4QyxXQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ1gsV0FBTSxHQUFHLENBQUMsQ0FBQztRQUlmLElBQUksQ0FBQyxLQUFLLEdBQUcsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3RCLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ2xCLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ2pELENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUU7WUFDVCxxQ0FBcUM7WUFDckMsSUFBSSxDQUFDLFdBQVcsR0FBRztnQkFDZixDQUFDLENBQUMsRUFBUSxDQUFDLENBQU87Z0JBQ2xCLENBQUMsR0FBRyxFQUFNLENBQUMsQ0FBTztnQkFDbEIsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBTztnQkFDbEIsQ0FBQyxDQUFDLEVBQVEsR0FBRyxDQUFLO2dCQUNsQixDQUFDLEdBQUcsRUFBTSxHQUFHLENBQUs7Z0JBQ2xCLENBQUMsR0FBRyxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUs7Z0JBQ2xCLENBQUMsQ0FBQyxFQUFRLEdBQUcsR0FBRyxDQUFDLENBQUM7Z0JBQ2xCLENBQUMsR0FBRyxFQUFNLEdBQUcsR0FBRyxDQUFDLENBQUM7Z0JBQ2xCLENBQUMsR0FBRyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDO2FBQ3JCLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFBO0lBQ04sQ0FBQztJQUVELE1BQU07UUFDRixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDcEIsQ0FBQztJQUVELFFBQVE7UUFDSixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHO1lBQ2YsT0FBTztRQUNYLE1BQU0sRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFFOUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUVqRCxNQUFNLElBQUksR0FBRyxHQUFHLENBQUM7UUFFakIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLEVBQ3pCLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksRUFDM0IsQ0FBQyxHQUFHLElBQUksRUFDUixDQUFDLEdBQUcsSUFBSSxDQUFDO1FBRWIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDeEQsR0FBRyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxHQUFHLEdBQUcsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUNyRSxHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFBO1FBQ3RFLEdBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssR0FBRyxHQUFHLEdBQUcsQ0FBQyxFQUFFLE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUVwRixHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLEdBQUcsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFBO1FBQ3JFLEdBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxHQUFHLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUNwRixHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxNQUFNLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFBO1FBQ3RFLEdBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssR0FBRyxHQUFHLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsTUFBTSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQTtRQUVwRixHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEtBQUssR0FBRyxDQUFDLEdBQUcsR0FBRyxFQUFFLE1BQU0sR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUE7SUFDeEYsQ0FBQztJQUVELElBQUksSUFBSTtRQUNKLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBRUQsSUFBSSxLQUFLO1FBQ0wsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQzFDLENBQUM7SUFFRCxJQUFJLEtBQUssQ0FBQyxDQUFDO1FBQ1AsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztJQUNqQyxDQUFDO0lBRUQsSUFBSSxNQUFNO1FBQ04sT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQzNDLENBQUM7SUFFRCxJQUFJLE1BQU0sQ0FBQyxDQUFDO1FBQ1IsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUNsQyxDQUFDO0lBRUQsSUFBSSxNQUFNO1FBQ04sT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUM1QixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbnN0YW5jZSB9IGZyb20gXCIuL2luc3RhbmNlLmpzXCI7XG5pbXBvcnQgeyBQb2ludCB9IGZyb20gXCIuL21hdGguanNcIjtcblxuZXhwb3J0IGNvbnN0IGltYWdlczogSFRNTEltYWdlRWxlbWVudFtdID0gW107XG5cbmV4cG9ydCBjb25zdCBsb2FkSW1hZ2UgPSAoc3JjOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCBpbWFnZSA9IGltYWdlcy5maW5kKGkgPT4gaS5pZCA9PSBzcmMpO1xuICAgIGlmIChpbWFnZSkgcmV0dXJuIGltYWdlO1xuICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xuICAgIGltZy5zcmMgPSBzcmM7XG4gICAgaW1nLmlkID0gc3JjO1xuICAgIGltYWdlcy5wdXNoKGltZyk7XG4gICAgcmV0dXJuIGltZztcbn1cblxuZXhwb3J0IGNsYXNzIEltYWdlSW5zdGFuY2UgZXh0ZW5kcyBJbnN0YW5jZSB7XG4gICAgcHJvdGVjdGVkIGltYWdlOiBIVE1MSW1hZ2VFbGVtZW50O1xuICAgIHByaXZhdGUgc2NhbGVYID0gMTtcbiAgICBwcml2YXRlIHNjYWxlWSA9IDE7XG5cbiAgICBjb25zdHJ1Y3RvcihpbWFnZVVybDogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuaW1hZ2UgPSBsb2FkSW1hZ2UoaW1hZ2VVcmwpO1xuICAgIH1cblxuICAgIG9uRHJhdygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kcmF3U2VsZigpO1xuICAgIH1cblxuICAgIGRyYXdTZWxmKCkge1xuICAgICAgICBpZiAoIXRoaXMuaW1hZ2Uuc3JjKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLmRyYXdJbWFnZSh0aGlzLmltYWdlLCAwLCAwLCB0aGlzLmltYWdlLndpZHRoICogdGhpcy5zY2FsZVgsIHRoaXMuaW1hZ2UuaGVpZ2h0ICogdGhpcy5zY2FsZVkpO1xuICAgIH1cblxuICAgIGdldCB3aWR0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW1hZ2Uud2lkdGggKiB0aGlzLnNjYWxlWDtcbiAgICB9XG5cbiAgICBzZXQgd2lkdGgodykge1xuICAgICAgICB0aGlzLnNjYWxlWCA9IHcgLyB0aGlzLndpZHRoO1xuICAgIH1cblxuICAgIGdldCBoZWlnaHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmltYWdlLmhlaWdodCAqIHRoaXMuc2NhbGVZO1xuICAgIH1cblxuICAgIHNldCBoZWlnaHQoaCkge1xuICAgICAgICB0aGlzLnNjYWxlWSA9IGggLyB0aGlzLmhlaWdodDtcbiAgICB9XG5cbiAgICBnZXQgY2VudGVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWN0LmNlbnRlcjtcbiAgICB9XG5cbiAgICBzZXQgY2VudGVyKHA6IFBvaW50KSB7XG4gICAgICAgIHRoaXMueCA9IHAueCAtIHRoaXMud2lkdGggLyAyO1xuICAgICAgICB0aGlzLnkgPSBwLnkgLSB0aGlzLmhlaWdodCAvIDI7XG4gICAgfVxuXG4gICAgZ2V0IHJlY3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFJlY3QodGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgIH1cbn1cblxuLy8gVE9ETzogZml4IGNvcHktcGFzdGVcbmV4cG9ydCBjbGFzcyBJbWFnZTlJbnN0YW5jZSBleHRlbmRzIEluc3RhbmNlIHtcbiAgICBwcm90ZWN0ZWQgaW1hZ2U6IEhUTUxJbWFnZUVsZW1lbnQ7XG4gICAgcHJpdmF0ZSBpbWFnZVNsaWNlczogIFtudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXJdW107XG4gICAgcHJpdmF0ZSBzY2FsZVggPSAxO1xuICAgIHByaXZhdGUgc2NhbGVZID0gMTtcblxuICAgIGNvbnN0cnVjdG9yKGltYWdlVXJsOiBzdHJpbmcsIHB1YmxpYyBwYWQ6IG51bWJlcikge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmltYWdlID0gbG9hZEltYWdlKGltYWdlVXJsKTtcbiAgICAgICAgdGhpcy5pbWFnZVNsaWNlcyA9IFtdO1xuICAgICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgICAgIHRoaXMuaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIHJlc29sdmUpO1xuICAgICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIC8vIGRlZmluZSB0aGUgOSBwYXJ0cyBhcyBbeCwgeSwgdywgaF1cbiAgICAgICAgICAgIHRoaXMuaW1hZ2VTbGljZXMgPSBbXG4gICAgICAgICAgICAgICAgWzAsICAgICAgIDAgICAgICBdLFxuICAgICAgICAgICAgICAgIFtwYWQsICAgICAwICAgICAgXSxcbiAgICAgICAgICAgICAgICBbcGFkICogMiwgMCAgICAgIF0sXG4gICAgICAgICAgICAgICAgWzAsICAgICAgIHBhZCAgICBdLFxuICAgICAgICAgICAgICAgIFtwYWQsICAgICBwYWQgICAgXSxcbiAgICAgICAgICAgICAgICBbcGFkICogMiwgcGFkICAgIF0sXG4gICAgICAgICAgICAgICAgWzAsICAgICAgIHBhZCAqIDJdLFxuICAgICAgICAgICAgICAgIFtwYWQsICAgICBwYWQgKiAyXSxcbiAgICAgICAgICAgICAgICBbcGFkICogMiwgcGFkICogMl1cbiAgICAgICAgICAgIF0ubWFwKHggPT4gW3hbMF0sIHhbMV0sIHBhZCwgcGFkXSk7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgb25EcmF3KCkge1xuICAgICAgICB0aGlzLmRyYXdTZWxmKCk7XG4gICAgfVxuXG4gICAgZHJhd1NlbGYoKSB7XG4gICAgICAgIGlmICghdGhpcy5pbWFnZS5zcmMpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHsgcGFkLCBpbWFnZVNsaWNlcywgaW1hZ2UsIGN0eCB9ID0gdGhpcztcblxuICAgICAgICBjdHgudHJhbnNsYXRlKC10aGlzLndpZHRoIC8gMiwgLXRoaXMuaGVpZ2h0IC8gMik7XG5cbiAgICAgICAgY29uc3Qgc2l6ZSA9IDAuNTtcblxuICAgICAgICBsZXQgd2lkdGggPSB0aGlzLndpZHRoICsgc2l6ZSxcbiAgICAgICAgICAgIGhlaWdodCA9IHRoaXMuaGVpZ2h0ICsgc2l6ZSxcbiAgICAgICAgICAgIHggPSBzaXplLFxuICAgICAgICAgICAgeSA9IHNpemU7XG5cbiAgICAgICAgY3R4LmRyYXdJbWFnZShpbWFnZSwgLi4uaW1hZ2VTbGljZXNbMF0sIHgsIHksIHBhZCwgcGFkKTtcbiAgICAgICAgY3R4LmRyYXdJbWFnZShpbWFnZSwgLi4uaW1hZ2VTbGljZXNbMl0sIHdpZHRoIC0gcGFkIC0geCwgeSwgcGFkLCBwYWQpXG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2UsIC4uLmltYWdlU2xpY2VzWzZdLCB4LCBoZWlnaHQgLSBwYWQgLSB5LCBwYWQsIHBhZClcbiAgICAgICAgY3R4LmRyYXdJbWFnZShpbWFnZSwgLi4uaW1hZ2VTbGljZXNbOF0sIHdpZHRoIC0gcGFkIC0geCwgaGVpZ2h0IC0gcGFkIC0geSwgcGFkLCBwYWQpXG5cbiAgICAgICAgY3R4LmRyYXdJbWFnZShpbWFnZSwgLi4uaW1hZ2VTbGljZXNbMV0sIHBhZCwgeSwgd2lkdGggLSAyICogcGFkLCBwYWQpXG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2UsIC4uLmltYWdlU2xpY2VzWzddLCBwYWQsIGhlaWdodCAtIHBhZCAtIHksIHdpZHRoIC0gMiAqIHBhZCwgcGFkKVxuICAgICAgICBjdHguZHJhd0ltYWdlKGltYWdlLCAuLi5pbWFnZVNsaWNlc1szXSwgeCwgcGFkLCBwYWQsIGhlaWdodCAtIDIgKiBwYWQpXG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2UsIC4uLmltYWdlU2xpY2VzWzVdLCB3aWR0aCAtIHBhZCAtIHgsIHBhZCwgcGFkLCBoZWlnaHQgLSAyICogcGFkKVxuXG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2UsIC4uLmltYWdlU2xpY2VzWzRdLCBwYWQsIHBhZCwgd2lkdGggLSAyICogcGFkLCBoZWlnaHQgLSAyICogcGFkKVxuICAgIH1cblxuICAgIGdldCByZWN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRSZWN0KHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICB9XG5cbiAgICBnZXQgd2lkdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmltYWdlLndpZHRoICogdGhpcy5zY2FsZVg7XG4gICAgfVxuXG4gICAgc2V0IHdpZHRoKHcpIHtcbiAgICAgICAgdGhpcy5zY2FsZVggPSB3IC8gdGhpcy53aWR0aDtcbiAgICB9XG5cbiAgICBnZXQgaGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbWFnZS5oZWlnaHQgKiB0aGlzLnNjYWxlWTtcbiAgICB9XG5cbiAgICBzZXQgaGVpZ2h0KGgpIHtcbiAgICAgICAgdGhpcy5zY2FsZVkgPSBoIC8gdGhpcy5oZWlnaHQ7XG4gICAgfVxuXG4gICAgZ2V0IGNlbnRlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVjdC5jZW50ZXI7XG4gICAgfVxufSJdfQ==